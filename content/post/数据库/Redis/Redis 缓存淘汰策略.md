---
title: "1 Redis 缓存淘汰策略"
date: 2023-01-01T01:01:01+08:00
categories: ["D:"]
tags: ["D:"]
draft: false
---
# 1 Redis 缓存淘汰策略

## 1.1 概述
Redis作为内存数据库，当内存使用达到最大内存限制时，需要使用淘汰策略来释放空间。Redis提供了多种淘汰策略，以满足不同场景的需求。

## 1.2 内存淘汰策略分类

### 1.2.1 不进行数据淘汰
- **noeviction**
  - 当内存不足时拒绝写入新数据
  - 只响应读操作
  - 适用于：要求数据绝对可靠，不允许丢失的场景

### 1.2.2 基于LRU（最近最少使用）算法
- **allkeys-lru**
  - 对所有key使用LRU算法进行淘汰
  - 优点：利用缓存局部性原理，保留热点数据
  - 适用于：大多数场景的默认选择

- **volatile-lru**
  - 仅对设置了过期时间的key使用LRU算法淘汰
  - 优点：可以保留未设置过期时间的重要数据
  - 适用于：需要同时保留永久数据和临时数据的场景

### 1.2.3 基于LFU（最少使用频率）算法
- **allkeys-lfu**
  - 对所有key使用LFU算法进行淘汰
  - 优点：更精确地反映数据访问频率
  - 适用于：数据访问频率差异明显的场景

- **volatile-lfu**
  - 仅对设置了过期时间的key使用LFU算法淘汰
  - 优点：结合过期时间和访问频率
  - 适用于：对数据时效性和访问频率都敏感的场景

### 1.2.4 随机淘汰
- **allkeys-random**
  - 随机淘汰所有key
  - 优点：实现简单，消耗资源少
  - 适用于：数据无明显冷热区分的场景

- **volatile-random**
  - 随机淘汰设置了过期时间的key
  - 优点：保留永久数据
  - 适用于：临时数据无明显价值差异的场景

### 1.2.5 TTL淘汰
- **volatile-ttl**
  - 优先淘汰即将过期的key
  - 优点：按过期时间优先级淘汰
  - 适用于：数据时效性要求高的场景

## 1.3 配置方法

### 1.3.1 配置文件设置
```conf
# 设置最大内存
maxmemory 2gb
# 设置淘汰策略
maxmemory-policy allkeys-lru
```

### 1.3.2 命令行设置
```bash
# 动态设置最大内存
config set maxmemory 2gb
# 动态设置淘汰策略
config set maxmemory-policy allkeys-lru
```

## 1.4 策略选择建议

### 1.4.1 通用场景
- 推荐使用 **allkeys-lru**
  - 能有效保留热点数据
  - 实现简单，性能好

### 1.4.2 精确控制场景
- 推荐使用 **allkeys-lfu**
  - 更准确的数据访问统计
  - 适合访问模式稳定的应用

### 1.4.3 带有永久数据场景
- 推荐使用 **volatile-lru** 或 **volatile-lfu**
  - 可以保护不设置过期时间的重要数据
  - 灵活控制临时数据的淘汰

### 1.4.4 数据平等场景
- 推荐使用 **allkeys-random**
  - 所有数据机会均等
  - 适合数据价值差异不大的场景

## 1.5 最佳实践

1. **监控内存使用情况**
   - 定期检查内存使用率
   - 设置合理的报警阈值

2. **合理设置最大内存**
   - 建议最大内存设置为物理内存的3/4
   - 预留足够的系统内存

3. **定期检查淘汰效果**
   - 监控淘汰频率
   - 评估策略是否合适

4. **根据业务调整策略**
   - 结合业务访问特点
   - 适时调整淘汰策略

## 1.6 注意事项

1. **避免内存溢出**
   - 合理设置最大内存
   - 及时监控内存使用

2. **防止性能影响**
   - 避免频繁触发淘汰
   - 预留足够内存空间

3. **数据一致性**
   - 注意缓存淘汰对业务的影响
   - 做好容错处理
