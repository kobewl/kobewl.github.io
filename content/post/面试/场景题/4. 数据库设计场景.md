---
title: "数据库设计场景题"
date: 2023-01-01T01:01:01+08:00
categories: ["D:"]
tags: ["D:"]
draft: false
---
# 数据库设计场景题

## 1. 电商订单系统设计

### 场景描述

设计一个电商平台的订单系统数据库。

### 核心要求

- 支持订单状态流转
- 处理订单商品关系
- 支持订单查询统计
- 考虑数据量增长

### 数据库设计

```sql
-- 订单主表
CREATE TABLE orders (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    order_no VARCHAR(32) NOT NULL COMMENT '订单号',
    user_id BIGINT NOT NULL COMMENT '用户ID',
    total_amount DECIMAL(10,2) NOT NULL COMMENT '订单总金额',
    status TINYINT NOT NULL COMMENT '订单状态：0-待付款,1-已付款,2-已发货,3-已完成',
    create_time DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
    update_time DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    INDEX idx_user_id (user_id),
    INDEX idx_order_no (order_no)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

-- 订单商品表
CREATE TABLE order_items (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    order_id BIGINT NOT NULL COMMENT '订单ID',
    product_id BIGINT NOT NULL COMMENT '商品ID',
    quantity INT NOT NULL COMMENT '购买数量',
    price DECIMAL(10,2) NOT NULL COMMENT '商品单价',
    INDEX idx_order_id (order_id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;
```

## 2. 社交平台关注关系设计

### 场景描述

设计一个类似微博的社交平台关注关系数据库。

### 核心要求

- 支持用户关注/取关
- 获取关注列表
- 获取粉丝列表
- 支持互关查询

### 数据库设计

```sql
-- 用户关注关系表
CREATE TABLE user_relations (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    follower_id BIGINT NOT NULL COMMENT '关注者ID',
    following_id BIGINT NOT NULL COMMENT '被关注者ID',
    create_time DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
    INDEX idx_follower (follower_id),
    INDEX idx_following (following_id),
    UNIQUE KEY uk_relation (follower_id, following_id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

-- 查询互关用户
SELECT a.follower_id, a.following_id
FROM user_relations a
JOIN user_relations b ON a.follower_id = b.following_id
    AND a.following_id = b.follower_id;
```

## 3. 分库分表设计

### 场景描述

设计一个支持水平分库分表的用户订单系统。

### 核心要求

- 支持按用户 ID 分库
- 支持按时间分表
- 考虑跨库查询
- 保证数据一致性

### 设计方案

1. 分库策略

```java
// 按用户ID分库
public class DatabaseShardingStrategy {
    private static final int DB_COUNT = 4;

    public static int getDatabase(long userId) {
        return (int) (userId % DB_COUNT);
    }
}
```

2. 分表策略

```sql
-- 按月分表示例
CREATE TABLE orders_202401 (
    id BIGINT PRIMARY KEY,
    user_id BIGINT NOT NULL,
    order_no VARCHAR(32) NOT NULL,
    -- 其他字段
    INDEX idx_user_id (user_id)
) ENGINE=InnoDB;

CREATE TABLE orders_202402 (
    -- 表结构相同
);
```

