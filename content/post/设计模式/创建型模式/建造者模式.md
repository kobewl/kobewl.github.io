---
title: "建造者模式（Builder Pattern）"
date: 2023-01-01T01:01:01+08:00
categories: ["D:"]
tags: ["D:"]
draft: false
---
# 建造者模式（Builder Pattern）

## 概述

建造者模式是一种创建型设计模式，它允许你分步骤创建复杂对象。该模式允许你使用相同的创建代码生成不同类型和形式的对象。

## 使用场景

- 需要创建的对象有复杂的内部结构（包含多个成员变量）
- 需要生成的对象内部属性之间有一定的依赖关系
- 对象的创建过程独立于创建该对象的类
- 隔离复杂对象的创建和使用，并使得相同的创建过程可以创建不同的产品

## 结构示例

```java
// 产品类
class Computer {
    private String cpu;        // 必须
    private String ram;        // 必须
    private String storage;    // 可选
    private String gpu;        // 可选
    private String monitor;    // 可选

    private Computer(Builder builder) {
        this.cpu = builder.cpu;
        this.ram = builder.ram;
        this.storage = builder.storage;
        this.gpu = builder.gpu;
        this.monitor = builder.monitor;
    }

    // Getter方法
    public String getCpu() { return cpu; }
    public String getRam() { return ram; }
    public String getStorage() { return storage; }
    public String getGpu() { return gpu; }
    public String getMonitor() { return monitor; }

    // 静态Builder类
    public static class Builder {
        private String cpu;    // 必须
        private String ram;    // 必须
        private String storage;
        private String gpu;
        private String monitor;

        // 构造函数中初始化必须的参数
        public Builder(String cpu, String ram) {
            this.cpu = cpu;
            this.ram = ram;
        }

        // 可选参数的设置方法，返回Builder本身
        public Builder storage(String storage) {
            this.storage = storage;
            return this;
        }

        public Builder gpu(String gpu) {
            this.gpu = gpu;
            return this;
        }

        public Builder monitor(String monitor) {
            this.monitor = monitor;
            return this;
        }

        // 构建方法
        public Computer build() {
            return new Computer(this);
        }
    }

    @Override
    public String toString() {
        return "Computer{" +
                "cpu='" + cpu + '\'' +
                ", ram='" + ram + '\'' +
                ", storage='" + storage + '\'' +
                ", gpu='" + gpu + '\'' +
                ", monitor='" + monitor + '\'' +
                '}';
    }
}
```

## 实际应用示例

以创建一个网络请求对象为例：

```java
// 网络请求类
public class HttpRequest {
    private final String url;
    private final String method;
    private final Map<String, String> headers;
    private final Map<String, String> parameters;
    private final String body;
    private final int timeout;
    private final boolean followRedirects;

    private HttpRequest(Builder builder) {
        this.url = builder.url;
        this.method = builder.method;
        this.headers = builder.headers;
        this.parameters = builder.parameters;
        this.body = builder.body;
        this.timeout = builder.timeout;
        this.followRedirects = builder.followRedirects;
    }

    public static class Builder {
        private final String url;              // 必须
        private String method = "GET";         // 默认值
        private Map<String, String> headers = new HashMap<>();
        private Map<String, String> parameters = new HashMap<>();
        private String body;
        private int timeout = 30000;           // 默认30秒
        private boolean followRedirects = true;// 默认值

        public Builder(String url) {
            this.url = url;
        }

        public Builder method(String method) {
            this.method = method;
            return this;
        }

        public Builder addHeader(String key, String value) {
            this.headers.put(key, value);
            return this;
        }

        public Builder addParameter(String key, String value) {
            this.parameters.put(key, value);
            return this;
        }

        public Builder body(String body) {
            this.body = body;
            return this;
        }

        public Builder timeout(int timeout) {
            this.timeout = timeout;
            return this;
        }

        public Builder followRedirects(boolean followRedirects) {
            this.followRedirects = followRedirects;
            return this;
        }

        public HttpRequest build() {
            return new HttpRequest(this);
        }
    }
}

// 使用示例
public class BuilderDemo {
    public static void main(String[] args) {
        // 创建一个简单的GET请求
        HttpRequest getRequest = new HttpRequest.Builder("http://api.example.com")
            .addHeader("Accept", "application/json")
            .build();

        // 创建一个复杂的POST请求
        HttpRequest postRequest = new HttpRequest.Builder("http://api.example.com/users")
            .method("POST")
            .addHeader("Content-Type", "application/json")
            .addHeader("Authorization", "Bearer token123")
            .body("{\"name\":\"John\",\"age\":30}")
            .timeout(5000)
            .followRedirects(false)
            .build();
    }
}
```

## 优点

1. 允许你分步创建对象，而且可以暂缓创建步骤或递归运行创建步骤
2. 生成的对象有统一的创建过程
3. 允许在对象创建过程中增加约束条件的检查
4. 代码复用性高，建造者模式将复杂对象的创建过程封装在建造者类中
5. 使用建造者模式可以使对象的创建更加清晰易读

## 缺点

1. 要求对象的组成部分必须相对稳定，若经常变化会导致建造者模式变得复杂
2. 建造者模式创建的对象一般都有较多的共同点，若差异性很大，则不适合使用
3. 如果对象的属性较少，使用建造者模式可能会显得多余

## 适用场景

1. 需要生成的对象具有复杂的内部结构
2. 需要生成的对象内部属性本身相互依赖
3. 对象的创建过程中需要增加约束条件的检查
4. 创建一些具有许多可选参数的对象时

## 注意事项

1. 建造者模式的构建过程必须是稳定的
2. 建造者模式更注重方法的调用顺序
3. 建造者模式可以与其他模式结合使用，例如与单例模式、工厂模式的结合
4. 在使用建造者模式时，要注意区分必选参数和可选参数

